<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Freeze - Jogo de Guerra de Bolas de Neve 3D</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="game-container">
        <div id="ui-overlay">
            <div id="game-info">
                <div id="current-player">Personagem: 1</div>
                <div id="snowball-status">Status: Pronto para mover</div>
                <div id="force-meter" class="hidden">
                    <div class="meter-label">Força:</div>
                    <div class="meter-bar">
                        <div id="force-fill"></div>
                    </div>
                </div>
            </div>
            <div id="controls-help">
                <h3>Controles:</h3>
                <p><strong>Setas:</strong> Mover personagem</p>
                <p><strong>Shift+Setas:</strong> Correr</p>
                <p><strong>Tab:</strong> Trocar personagem</p>
                <p><strong>S:</strong> Fazer bola de neve (3s)</p>
                <p><strong>Espaço:</strong> Carregar força e lançar</p>
                <p style="color: #e74c3c;"><strong>C:</strong> ⚙️ Configurações</p>
                <br>
                <h3>Câmera:</h3>
                <p><strong>Click Esq:</strong> Rotacionar (suave)</p>
                <p><strong>Click Dir:</strong> Pan (mover X/Y)</p>
                <p><strong>Scroll:</strong> Zoom in/out</p>
                <p><strong>C:</strong> Capturar parâmetros</p>
                <br>
                <h3>Movimento:</h3>
                <p><strong>Setas:</strong> Andar</p>
                <p><strong>Shift+Setas:</strong> Correr</p>
            </div>
            
            <div id="camera-info" style="
                position: absolute;
                bottom: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.9);
                padding: 15px;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                font-size: 12px;
                font-family: monospace;
                color: #2c3e50;
                min-width: 250px;
            ">
                <strong>Parâmetros da Câmera:</strong><br>
                Posição: (0.0, 0.0, 0.0)<br>
                Target: (0.0, 0.0, 0.0)<br>
                Distância: 50.0<br>
                Theta: 0.00<br>
                Phi: 0.00
            </div>
        </div>
        <canvas id="game-canvas"></canvas>
    </div>

    <!-- Three.js - Local version for offline use -->
    <script src="libs/three.min.js"></script>
    
    <!-- OrbitControls for camera control -->
    <script>
        // OrbitControls implementation (inline to avoid external dependencies)
        class OrbitControls {
            constructor(camera, domElement) {
                this.camera = camera;
                this.domElement = domElement;
                
                this.enabled = true;
                this.enablePan = true;
                this.target = new THREE.Vector3(0, 0, 0);
                
                // Mouse interaction
                this.isMouseDown = false;
                this.isPanning = false;
                this.isRotating = false;
                this.mouseX = 0;
                this.mouseY = 0;
                this.phi = 0;
                this.theta = 0;
                this.radius = 50;
                
                // Limits
                this.minDistance = 10;
                this.maxDistance = 100;
                this.minPolarAngle = 0.1;
                this.maxPolarAngle = Math.PI - 0.1;
                
                this.setupEventListeners();
                this.update();
            }
            
            setupEventListeners() {
                this.domElement.addEventListener('mousedown', (e) => this.onMouseDown(e));
                this.domElement.addEventListener('mousemove', (e) => this.onMouseMove(e));
                this.domElement.addEventListener('mouseup', (e) => this.onMouseUp(e));
                this.domElement.addEventListener('wheel', (e) => this.onWheel(e));
                this.domElement.addEventListener('contextmenu', (e) => e.preventDefault());
            }
            
            onMouseDown(event) {
                if (!this.enabled) return;
                this.isMouseDown = true;
                
                // Left click = rotation, Right click = panning
                this.isPanning = (event.button === 2) && this.enablePan; // Right mouse button
                this.isRotating = (event.button === 0); // Left mouse button
                
                this.mouseX = event.clientX;
                this.mouseY = event.clientY;
            }
            
            onMouseMove(event) {
                if (!this.enabled || !this.isMouseDown) return;
                
                const deltaX = event.clientX - this.mouseX;
                const deltaY = event.clientY - this.mouseY;
                
                if (this.isPanning) {
                    // Pan mode (Right click drag)
                    const panSpeed = 0.02;
                    const right = new THREE.Vector3();
                    const up = new THREE.Vector3();
                    
                    // Get camera's right and up vectors
                    right.setFromMatrixColumn(this.camera.matrix, 0);
                    up.setFromMatrixColumn(this.camera.matrix, 1);
                    
                    // Pan target
                    right.multiplyScalar(-deltaX * panSpeed);
                    up.multiplyScalar(deltaY * panSpeed);
                    
                    this.target.add(right);
                    this.target.add(up);
                } else if (this.isRotating) {
                    // Orbit mode (Left click drag) - smoother rotation
                    this.theta -= deltaX * 0.005; // Reduced sensitivity for smoother rotation
                    this.phi += deltaY * 0.005;
                    
                    this.phi = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, this.phi));
                }
                
                this.mouseX = event.clientX;
                this.mouseY = event.clientY;
                
                this.update();
            }
            
            onMouseUp(event) {
                this.isMouseDown = false;
                this.isPanning = false;
                this.isRotating = false;
            }
            
            onWheel(event) {
                if (!this.enabled) return;
                event.preventDefault();
                
                this.radius += event.deltaY * 0.01;
                this.radius = Math.max(this.minDistance, Math.min(this.maxDistance, this.radius));
                
                this.update();
            }
            
            update() {
                const x = this.radius * Math.sin(this.phi) * Math.cos(this.theta);
                const y = this.radius * Math.cos(this.phi);
                const z = this.radius * Math.sin(this.phi) * Math.sin(this.theta);
                
                this.camera.position.set(
                    this.target.x + x,
                    this.target.y + y,
                    this.target.z + z
                );
                
                this.camera.lookAt(this.target);
                
                // Update camera info display
                this.updateCameraInfo();
            }
            
            updateCameraInfo() {
                const info = document.getElementById('camera-info');
                if (info) {
                    info.innerHTML = `
                        <strong>Parâmetros da Câmera:</strong><br>
                        Posição: (${this.camera.position.x.toFixed(1)}, ${this.camera.position.y.toFixed(1)}, ${this.camera.position.z.toFixed(1)})<br>
                        Target: (${this.target.x.toFixed(1)}, ${this.target.y.toFixed(1)}, ${this.target.z.toFixed(1)})<br>
                        Distância: ${this.radius.toFixed(1)}<br>
                        Theta: ${this.theta.toFixed(2)}<br>
                        Phi: ${this.phi.toFixed(2)}
                    `;
                }
            }
            
            setFromPosition(x, y, z, targetX = 0, targetY = 0, targetZ = 0) {
                this.target.set(targetX, targetY, targetZ);
                
                const dx = x - targetX;
                const dy = y - targetY;
                const dz = z - targetZ;
                
                this.radius = Math.sqrt(dx * dx + dy * dy + dz * dz);
                this.theta = Math.atan2(dz, dx);
                this.phi = Math.acos(dy / this.radius);
                
                this.update();
            }
        }
        
        window.OrbitControls = OrbitControls;
    </script>
    
    <!-- Cannon.js - Local version for offline use -->
    <script src="libs/cannon.min.js"></script>
    
    <!-- Game Scripts -->
    <script src="js/core/SimplePhysics.js"></script>
    <script src="js/core/GameEngine.js"></script>
    <script src="js/entities/Character.js"></script>
    <script src="js/entities/Snowball.js"></script>
    <script src="js/entities/Barrier.js"></script>
    <script src="js/mechanics/InputController.js"></script>
    <script src="js/mechanics/GameMechanics.js"></script>
    <script src="js/ai/SimpleAI.js"></script>
    <script src="js/ui/UIManager.js"></script>
    <script src="js/ui/ConfigPanel.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
